<div class="dashboard-container">
    <aside class="sidebar">
        <div class="filters">
            <input type="text" placeholder="Search by name or symbol..." [(ngModel)]="searchTerm"
                (input)="applyFilters()" />

            <select [(ngModel)]="selectedIndustry" (change)="applyFilters()">
                <option value="">All Industries</option>
                <option *ngFor="let ind of industries" [value]="ind">{{ ind }}</option>
            </select>

            <select [(ngModel)]="priceOrder" (change)="applyFilters()">
                <option value="">Sort by Price</option>
                <option value="high">High to Low</option>
                <option value="low">Low to High</option>
            </select>

        </div>
                <div>
            <app-chat></app-chat>
        </div>

        <div class="stock-scroll">
            <div class="stock-card" *ngFor="let stock of filteredStocks" (click)="selectStock(stock)"
                [class.active]="stock === selectedStock">
                <div class="stock-header">
                    <h3>{{ stock.symbol }}</h3>
                    <span [ngClass]="{positive: stock.change > 0, negative: stock.change < 0}">
                        {{ stock.change > 0 ? '+' : '' }}{{ stock.change | number:'1.2-2' }}
                    </span>
                </div>
                <div class="stock-meta">
                    <div><strong>{{ stock.name }}</strong></div>
                    <div>${{ stock.currentPrice.toFixed(2) }}</div>
                    <div><em>{{ stock.industry }}</em></div>
                </div>
            </div>
        </div>
    </aside>

    <section class="chart-section" *ngIf="selectedStock" #chartSection>
        <h3 class="chart-title">{{ selectedStock.symbol }} Price History</h3>
        <div class="range-buttons">
            <button (click)="setRange(7)">7 Days</button>
            <button (click)="setRange(30)">30 Days</button>
            <button (click)="setRange(90)">90 Days</button>
        </div>
        <canvas baseChart [data]="chartData" [options]="chartOptions" type="line"></canvas>
        <!-- Buy/Sell Buttons -->
        <div class="action-buttons" *ngIf="selectedStock">
            <button (click)="openPopup('buy')">Buy Stock</button>
            <button (click)="openPopup('sell')">Sell Stock</button>
        </div>
    </section>
    <!-- Buy Popup -->
    <div class="popup" *ngIf="showBuyPopup">
    <div class="popup-content">
        <span class="close" (click)="closePopup('buy')">&times;</span>
        <h2>Buy Stock</h2>
        <form (ngSubmit)="confirmBuy()">
        <input type="text" placeholder="Stock Symbol" [(ngModel)]="buySymbol" name="buySymbol" required readonly>
        <input type="number" placeholder="Quantity" [(ngModel)]="buyQuantity" name="buyQuantity" required>
        <input type="number" placeholder="Price per Share" [(ngModel)]="buyPrice" name="buyPrice" required>
        <button type="submit">Confirm Buy</button>
        </form>
    </div>
    </div>

    <!-- Sell Popup -->
    <div class="popup" *ngIf="showSellPopup">
    <div class="popup-content">
        <span class="close" (click)="closePopup('sell')">&times;</span>
        <h2>Sell Stock</h2>
        <form (ngSubmit)="confirmSell()">
        <input type="text" placeholder="Stock Symbol" [(ngModel)]="sellSymbol" name="sellSymbol" required readonly>
        <input type="number" placeholder="Quantity" [(ngModel)]="sellQuantity" name="sellQuantity" required>
        <input type="number" placeholder="Price per Share" [(ngModel)]="sellPrice" name="sellPrice" required>
        <button type="submit">Confirm Sell</button>
        </form>
    </div>
</div>
